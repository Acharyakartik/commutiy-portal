{% extends "html_member/base.html" %}

{% block title %}Member Dashboard{% endblock %}
{% block nav_dashboard %}active{% endblock %}

{% block page_title %}
Dashboard Overview
{% endblock %}

{% block page_subtitle %}
Welcome back, {{ member.first_name|default:"Member" }}
{% endblock %}

{% block content %}
<div class="container-fluid">

    <!-- ================= STAT CARDS ================= -->
    <div class="row mb-4">

        <div class="col-lg-6 col-12">
            <div class="small-box bg-info shadow-sm">
                <div class="inner">
                    <h3>{{ total_all }}</h3>
                    <p>total Details</p>
                </div>
                <div class="icon">
                    <i class="fas fa-id-card"></i>
                </div>
            </div>
        </div>

        <div class="col-lg-6 col-12">
            <div class="small-box bg-success shadow-sm">
                <div class="inner">
                    <h3>{{ total_details}}</h3>
                    <p>Member details</p>
                </div>
                <div class="icon">
                    <i class="fas fa-id-card"></i>
                </div>
            </div>
        </div>

    </div>

    <!-- ========================================================= -->
    <!-- ===================== MEMBER TABLE ===================== -->
    <!-- ========================================================= -->

    <div class="card card-outline card-primary shadow-sm mb-4">

        <div class="card-header d-flex justify-content-between align-items-center">
            <h3 class="card-title">
                <i class="fas fa-users mr-1"></i>
                Select member to change
            </h3>

            <a href="#" class="btn btn-sm btn-primary">
                <i class="fas fa-user-plus"></i> Add member
            </a>
        </div>

        <div class="card-body table-responsive p-0">
            <table id="memberTable"
                   class="table table-bordered table-hover table-striped text-nowrap">

                <thead class="thead-light">
                    <tr>
                        <th>ID</th>
                        <th>Member no</th>
                        <th>First name</th>
                        <th>Surname</th>
                        <th>Phone</th>
                        <th>Status</th>
                        <th>Total details</th>
                    </tr>
                </thead>

                <tbody>
                {% for m in members %}
                    <tr>
                        <td>{{ m.member_no }}</td>
                        <td>{{ m.member_no }}</td>
                        <td>{{ m.first_name }}</td>
                        <td>{{ m.surname }}</td>
                        <td>{{ m.phone_no }}</td>

                        <td>
                            {% if m.status == "Active" %}
                                <span class="badge badge-success">Active</span>
                            {% else %}
                                <span class="badge badge-danger">Inactive</span>
                            {% endif %}
                        </td>

                        <td>
                            <span class="badge badge-info">
                                {{ m.detail_count }}
                            </span>
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="7" class="text-center text-muted py-4">
                            No members found
                        </td>
                    </tr>
                {% endfor %}
                </tbody>

            </table>
        </div>
    </div>

    <!-- ========================================================= -->
    <!-- ================= MEMBER DETAIL TABLE ================== -->
    <!-- ========================================================= -->

    <div class="card card-outline card-success shadow-sm">

        <div class="card-header d-flex justify-content-between align-items-center">
            <h3 class="card-title">
                <i class="fas fa-id-card mr-1"></i>
                Select member detail to change
            </h3>

            <a href="{% url 'member:member_detail_add' %}" class="btn btn-sm btn-success">
                <i class="fas fa-plus"></i> Add member detail
            </a>
        </div>

        <div class="card-body table-responsive p-0">
            <table id="detailTable"
                   class="table table-bordered table-hover table-striped text-nowrap">

                <thead class="thead-light">
                    <tr>
                        <th>ID</th>
                        <th>Member no</th>
                        <th>First name</th>
                        <th>Surname</th>
                        <th>Date of birth</th>
                        <th>Age</th>
                        <th>Gender</th>
                        <th>Occupation</th>
                        <th>Created by</th>
                        <th>Created at</th>
                        <th>Updated by</th>
                        <th>Updated at</th>
                    </tr>
                </thead>

                <tbody>
                {% for d in member_details %}
                    <tr>
                        <td>{{ d.member_id }}</td>
                        <td>{{ d.member_no }}</td>
                        <td>{{ d.first_name }}</td>
                        <td>{{ d.surname }}</td>
                        <td>{{ d.date_of_birth|default:"-" }}</td>
                        <td>{{ d.age }}</td>
                        <td>{{ d.get_gender_display }}</td>
                        <td>{{ d.occupation|default:"-" }}</td>
                        <td>{{ d.created_by.username|default:"System" }}</td>
                        <td>{{ d.created_at|date:"M d, Y, h:i a" }}</td>
                        <td>{{ d.updated_by.username|default:"-" }}</td>
                        <td>{{ d.updated_at|date:"M d, Y, h:i a" }}</td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="12" class="text-center text-muted py-4">
                            No member details found
                        </td>
                    </tr>
                {% endfor %}
                </tbody>

            </table>
        </div>
    </div>

</div>
{% endblock %}
{% block extra_js %}
<script>
$(function () {

    $('#memberTable').DataTable({
        responsive: true,
        searching: true,
        paging: true,
        ordering: true,
        pageLength: 10
    });

    $('#detailTable').DataTable({
        responsive: true,
        searching: true,
        paging: true,
        ordering: true,
        pageLength: 10,
        order: [[9, 'desc']]
    });

});
</script>
{% endblock %}
